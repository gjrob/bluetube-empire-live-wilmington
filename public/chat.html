<!doctype html><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Chat Overlay</title>
<style>
  :root{
    --w: 360px;            /* overlay width */
    --pad: 10px;           /* inner padding */
    --gap: 8px;            /* space between messages */
    --font: 16px;          /* base font size */
    --radius: 12px;        /* bubble radius (if using bubbles) */
    --shadow: 0 1px 1px rgba(0,0,0,.7), 0 0 8px rgba(0,0,0,.4);
  }
  html,body{height:100%;margin:0;background:transparent;overflow:hidden}
  /* right-side rail */
  .rail{
    position:fixed; right:16px; top:16px; bottom:16px;
    width:var(--w); display:flex; flex-direction:column-reverse;
    pointer-events:none;           /* clicks pass through */
  }
  /* scroll area with soft fades top/bottom */
  .list{
    flex:1; overflow:hidden; display:flex; flex-direction:column-reverse;
    -webkit-mask-image: linear-gradient(transparent, #000 10%, #000 90%, transparent);
            mask-image: linear-gradient(transparent, #000 10%, #000 90%, transparent);
  }
  .msgs{               /* actual scroller we translate for new items */
    display:flex; flex-direction:column;
    gap:var(--gap); padding:var(--pad);
    transform: translateY(0); transition: transform .25s ease-out;
  }
  .msg{
    color:#fff; font:600 var(--font)/1.3 system-ui, -apple-system, Segoe UI, Roboto;
    text-shadow: var(--shadow);
    display:flex; align-items:flex-start; gap:6px;
    opacity:0; transform: translateY(6px); animation: in .25s ease-out forwards;
  }
  .msg{background:rgba(0,0,0,.25); padding:8px 10px; border-radius:12px;}

  @keyframes in{ to{opacity:1; transform:none} }
  .name{margin-right:6px; white-space:nowrap}
  .body{white-space:pre-wrap; word-break:break-word}
  .badge{
    display:inline-block; font:700 10px/1.1 system-ui; padding:3px 6px;
    border-radius:999px; background:#ffd400; color:#111; margin-right:6px;
    text-shadow:none;
  }
  .emote, .emoji{height:1.25em; vertical-align:-.2em}
  /* small HUD time (optional) */
  .hud{
    position:absolute; left:-72px; top:4px; color:#fff; opacity:.9;
    font:700 14px/1 system-ui; text-shadow: var(--shadow);
  }
</style>

<!-- Twemoji for crisp emoji (optional) -->
<script src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js" defer></script>

<div class="rail">
  <div class="hud" id="hud"></div>
  <div class="list"><div class="msgs" id="msgs"></div></div>
</div>

<script>
const MAX_MSGS = 120;                // keep last N messages
const msgs = document.getElementById('msgs');

/* --- utilities --- */
const esc = s => s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
const linkify = s => esc(s)
  .replace(/(https?:\/\/\S+)/g,'<a href="$1" target="_blank" rel="noreferrer" style="color:#9ecbff;text-decoration:none">$1</a>');
function addMessage({user, text, color='#9ecbff', badges=[]}){
  const el = document.createElement('div');
  el.className='msg';
  const badgeHTML = badges.map(b=>`<span class="badge">${esc(b)}</span>`).join('');
  el.innerHTML = `
    <span class="name" style="color:${color}">${badgeHTML}${esc(user)}:</span>
    <span class="body">${linkify(text)}</span>
  `;
  msgs.appendChild(el);
  // trim old
  while (msgs.children.length > MAX_MSGS) msgs.removeChild(msgs.firstChild);
  // twemoji render if present
  if (window.twemoji) twemoji.parse(el, {folder:'svg', ext:'.svg'});
}

/* --- demo feed (remove in production) --- */
const ws = new WebSocket('wss://your-chat-server');
ws.onmessage = (e) => {
  const m = JSON.parse(e.data);           // {user, text, color?, badges?}
  window.pushChat(m.user, m.text, m.color, m.badges);
};
let di=0; setInterval(()=>addMessage(demo[(di++)%demo.length]), 1500);

setInterval(async ()=>{
  const res = await fetch('https://api.yourdomain/chat/latest?since=...');
  const list = await res.json();
  list.forEach(m => window.pushChat(m.user, m.text, m.color, m.badges));
}, 1500);
/* --- optional: clock in HUD --- */
setInterval(()=>{ document.getElementById('hud').textContent =
  new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);

/* --- public API (so OBS or page can push real chat) --- */
window.pushChat = (user, text, color='#9ecbff', badges=[]) => addMessage({user, text, color, badges});

/* Example: from console â†’ pushChat('Viewer','#ilovebluetube', '#7dd3fc', ['VIP']); */
</script>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rock Star Curtain Overlay</title>
  <style>
    /* base */
    html, body { margin:0; padding:0; background:transparent; height:100%; overflow:hidden; }
    :root { --speed:1.8s; }
.banner{
  max-width: var(--safeMax);
  text-align:center;
  padding: .1em .25em;
  border-radius: 16px;
  background: rgba(0,0,0,.22);
  backdrop-filter: blur(2px);
  border: 1px solid rgba(255,255,255,.06);
}
    /* stage */
    .stage { position:fixed; inset:0; pointer-events:none; display:grid; grid-template-rows:1fr auto; }
    .sky   { position:absolute; inset:0; overflow:hidden; z-index:1; }
    .banner-wrap { position:relative; z-index:2; display:grid; place-items:center; padding-top:min(7vh,80px); }

    /* banner */
    .banner {
      pointer-events:none; font-weight:900; letter-spacing:.04em; text-transform:uppercase;
      font-size:clamp(28px,10vw,160px); line-height:1; padding:.15em .35em; border-radius:16px;
      background:rgba(0,0,0,.28); backdrop-filter:blur(2px); border:1px solid rgba(255,255,255,.08);
      --gold1:#f6e27a; --gold2:#f9b233; --gold3:#f6d365; --gold4:#eab308; --gold5:#9a6b16;
      color:transparent; -webkit-text-stroke:1px rgba(0,0,0,.65);
      text-shadow:0 2px 0 rgba(0,0,0,.35), 0 4px 16px rgba(250,200,90,.35);
      background-image:linear-gradient(180deg,var(--gold1),var(--gold2) 28%,var(--gold3) 52%,var(--gold4) 75%,var(--gold5));
      -webkit-background-clip:text; background-clip:text; animation:glint 3.2s ease-in-out infinite;
    }
    @keyframes glint {
      0%,100%{ text-shadow:0 2px 0 rgba(0,0,0,.35), 0 4px 12px rgba(250,200,90,.25) }
      50%    { text-shadow:0 2px 0 rgba(0,0,0,.35), 0 6px 26px rgba(255,220,120,.55) }
    }
    .subtitle { margin-top:.6rem; font-size:clamp(12px,2.2vw,22px); color:rgba(255,255,255,.9); text-shadow:0 2px 6px rgba(0,0,0,.6); }

    /* ticker */
    .ticker { grid-row:2; width:100%; height:44px; display:grid; align-items:center;
      background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.35));
      border-top:1px solid rgba(255,255,255,.08); overflow:hidden; opacity:0; transition:opacity .6s ease; }
    .ticker.on { opacity:1; }
    .ticker-track { white-space:nowrap; will-change:transform; animation:scroll 20s linear infinite; }
    @keyframes scroll { from{transform:translateX(100%)} to{transform:translateX(-100%)} }

    /* logo pin */
    .logo-pin { position:absolute; right:1.2rem; top:1.2rem; z-index:3; opacity:0; transform:translateY(-8px);
      transition:opacity .8s ease, transform .8s ease; background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.1); border-radius:12px; padding:.5rem .65rem;
      display:grid; grid-auto-flow:column; gap:.5rem; align-items:center; backdrop-filter:blur(2px); }
    .logo-pin img { height:40px; width:auto; display:block; }
    .logo-pin span { color:#fff; font-weight:700; letter-spacing:.04em; text-transform:uppercase; font-size:12px; }
    .open .logo-pin { opacity:1; transform:translateY(0); }

    /* velvet curtains */
    .curtain { position:absolute; top:0; bottom:0; width:52vw; z-index:10;
      filter:drop-shadow(0 12px 16px rgba(0,0,0,.45));
      background:
        radial-gradient(120% 140% at 50% 10%, rgba(255,255,255,.08), rgba(255,255,255,0) 40%),
        repeating-linear-gradient(90deg, rgba(0,0,0,.20) 0 2px, rgba(0,0,0,0) 2px 30px),
        linear-gradient(180deg,#5d0a0a 0%, #2b0202 40%, #190000 100%);
      background-blend-mode:screen, multiply, normal;
      box-shadow:inset 0 -80px 160px rgba(0,0,0,.6);
      transform:translateX(0);
      transition:transform var(--speed) ease-in-out;
    }
    .curtain.left  { left:0;  transform-origin:left  center; border-right:2px solid gold; }
    .curtain.right { right:0; transform-origin:right center; border-left: 2px solid gold; }
    .rope { position:absolute; top:50%; width:100%; height:8px; background:linear-gradient(90deg,#7d2,#ed0,#a60);
      box-shadow:0 2px 6px rgba(0,0,0,.4) inset; opacity:.35; }

    /* states */
    .open .curtain.left  { transform:translateX(-102%); }
    .open .curtain.right { transform:translateX( 102%); }

    /* stars */
    .star { position:absolute; width:10px; height:10px; opacity:0; }
    .star::before { content:"★"; display:block; font-size:10px; }
    .star.gold { color:#ffd54a; } .star.white{ color:#fff; }
    @keyframes twinkle { 0%,100%{opacity:.0; transform:scale(.8) translateY(0)} 50%{opacity:1; transform:scale(1) translateY(-4px)} }
  </style>
</head>
<body>
  <div id="stage" class="stage closed">
    <!-- curtains -->
    <div class="curtain left"><div class="rope"></div></div>
    <div class="curtain right"><div class="rope"></div></div>

    <!-- stars -->
    <div class="sky" id="sky"></div>

    <!-- banner -->
    <div class="banner-wrap">
      <div id="banner" class="banner" aria-live="polite">ROCK ★ STAR</div>
      <div id="subtitle" class="subtitle"></div>
    </div>

    <!-- logo pin (optional) -->
    <div id="logoPin" class="logo-pin" hidden>
      <img id="logoImg" alt="Logo" />
      <span id="logoText"></span>
    </div>

    <!-- ticker (optional) -->
    <div id="ticker" class="ticker"><div id="tickerTrack" class="ticker-track"></div></div>
  </div>

  <script>
    /* URL controls:
       openAt(ms)=800 | speed(ms)=1800 | text=... | subtitle=...
       logo=URL | label=... | ticker=a|b|c | stars=0|1 | loop=0|1
    */
    const qs   = new URLSearchParams(location.search);
    const openDelay = +(qs.get('openAt') ?? 800);
    const speedMs   = +(qs.get('speed')  ?? 1800);
    const loop      =  qs.get('loop') === '1';
    const starsOn   =  qs.get('stars') !== '0';

    const stage   = document.getElementById('stage');
    const banner  = document.getElementById('banner');
    const subtitle= document.getElementById('subtitle');
    const ticker  = document.getElementById('ticker');
    const tickerTrack = document.getElementById('tickerTrack');
    const sky     = document.getElementById('sky');
    const logoPin = document.getElementById('logoPin');
    const logoImg = document.getElementById('logoImg');
    const logoText= document.getElementById('logoText');

    stage.style.setProperty('--speed', (speedMs/1000) + 's');

    if (qs.get('text'))     banner.textContent   = qs.get('text');
    if (qs.get('subtitle')) subtitle.textContent = qs.get('subtitle');

    if (qs.get('logo')) {
      logoImg.src = qs.get('logo');
      logoText.textContent = qs.get('label') || '';
      logoPin.hidden = false;
    }

    if (qs.get('ticker')) {
      const items = qs.get('ticker').split(',').map(s => s.trim()).filter(Boolean);
      tickerTrack.textContent = '  •  ' + items.join('  •  ') + '  •  ';
      ticker.classList.add('on');
    }
// Optional tuning via URL:
// padTop=px|vh (e.g. 60px or 6vh), safeMax=vw%|px, scale=0.8..1.4, vignette=rgba(...) or #000
const padTop  = qs.get('padTop');   if (padTop)  document.documentElement.style.setProperty('--padTop', padTop);
const safeMax = qs.get('safeMax');  if (safeMax) document.documentElement.style.setProperty('--safeMax', safeMax);
const scale   = qs.get('scale');    if (scale)   document.documentElement.style.setProperty('--scale', scale);
const vig     = qs.get('vignette'); if (vig)     document.documentElement.style.setProperty('--vignette', vig);

function spawnStars(n) {
  // pick based on viewport: fewer on small canvases
  const base = Math.max(18, Math.min(36, Math.floor(window.innerWidth / 50)));
  const count = n || base;
  for (let i = 0; i < count; i++) {
    const s = document.createElement('div');
    s.className = 'star ' + (Math.random() > 0.6 ? 'gold' : 'white');
    s.style.left = (Math.random() * 96 + 2) + 'vw';
    s.style.top  = (8 + Math.random() * 72) + 'vh';
    const d = (1.8 + Math.random() * 2.7).toFixed(2);
    const t = (Math.random() * 1.2).toFixed(2);
    s.style.animation = `twinkle ${d}s ease-in-out ${t}s infinite`;
    sky.appendChild(s);
  }
}


    function openCurtains(){ stage.classList.remove('closed'); stage.classList.add('open'); spawnStars(); }
    function closeCurtains(){ stage.classList.remove('open');   stage.classList.add('closed'); }
    function toggleCurtains(){ stage.classList.contains('open') ? closeCurtains() : openCurtains(); }

    setTimeout(openCurtains, Math.max(0, openDelay));

    if (loop){
      setInterval(() => { toggleCurtains(); }, Math.max(2200, speedMs + 2000));
    }

    // postMessage API from parent (OBS/Next)
    // window.postMessage({type:'rockstar', action:'open'|'close'|'toggle', text?, subtitle?, ticker?, logo?, label?, speed?})
    addEventListener('message', (e) => {
      const msg = e.data || {};
      if (msg.type !== 'rockstar') return;
      if (msg.speed) stage.style.setProperty('--speed', (msg.speed/1000) + 's');
      if (msg.text) banner.textContent = msg.text;
      if (msg.subtitle !== undefined) subtitle.textContent = msg.subtitle || '';
      if (msg.logo !== undefined) {
        if (msg.logo) { logoImg.src = msg.logo; logoText.textContent = msg.label || ''; logoPin.hidden = false; }
        else { logoPin.hidden = true; }
      }
      if (msg.ticker !== undefined) {
        if (msg.ticker) {
          const items = String(msg.ticker).split(',').map(s => s.trim()).filter(Boolean);
          tickerTrack.textContent = '  •  ' + items.join('  •  ') + '  •  ';
          ticker.classList.add('on');
        } else {
          ticker.classList.remove('on');
          tickerTrack.textContent = '';
        }
      }
      if (msg.action === 'open') openCurtains();
      else if (msg.action === 'close') closeCurtains();
      else if (msg.action === 'toggle') toggleCurtains();
    });
  </script>
</body>
</html>
